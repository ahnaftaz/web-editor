{"version":3,"sources":["transpiler/index.tsx","components/base-output.tsx","transpiler/plugins/module-request-plugin.ts","transpiler/plugins/path-resolution-plugin.ts","components/Box.tsx","components/Editor.tsx","index.tsx"],"names":["mainService","baseHTML","localCache","localforage","createInstance","name","moduleRequestPlugin","input","setup","build","onLoad","filter","loader","contents","args","getItem","path","cachedResult","axios","get","data","request","cleanedData","replace","result","resolveDir","URL","responseURL","pathname","setItem","transpile","esbuild","worker","wasmURL","entryPoints","bundle","write","plugins","onResolve","namespace","href","define","outputFiles","text","Box","resiseableProps","direction","children","maxConstraints","Infinity","window","innerHeight","height","width","resizeHandles","minConstraints","innerWidth","Editor","onChange","onMount","theme","defaultLanguage","defaultValue","options","wordWrap","minimap","enabled","lineNumbersMinChars","folding","fontSize","automaticLayout","App","iframe","useRef","useState","setInput","handleTranspileClick","current","contentWindow","srcdoc","transpiledCode","postMessage","style","display","flexDirection","className","margin","value","monaco","getModel","updateOptions","tabSize","backgroundColor","ref","title","sandbox","srcDoc","onClick","ReactDOM","render","document","querySelector"],"mappings":"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","file":"static/js/main.f90e71bc.chunk.js","sourcesContent":["import * as esbuild from 'esbuild-wasm';\nimport { pathResolvePlugin } from './plugins/path-resolution-plugin';\nimport { moduleRequestPlugin } from './plugins/module-request-plugin';\n\nlet mainService: esbuild.Service;\nconst transpile = async (input: string) => {\n  if (!mainService) {\n    mainService = await esbuild.startService({\n      worker: true,\n      wasmURL: 'https://unpkg.com/esbuild-wasm@0.8.27/esbuild.wasm',\n    });\n  }\n\n\n  // begin building file with all modules using custom plugins\n  const result = await mainService.build({\n    entryPoints: ['index.js'],\n    bundle: true,\n    write: false,\n    // plugin to handle path resolution and api request\n    plugins: [pathResolvePlugin(), moduleRequestPlugin(input)],\n    define: { 'process.env.NODE_ENV': '\"production\"' },\n  });\n\n  return result.outputFiles[0].text;\n}\n\nexport default transpile;\n","const baseHTML = `\n<html>\n  <head></head>\n  <body>\n    <div id=\"root\"></div>\n    <script>\n      window.addEventListener('message', (e) => {\n        try{\n          eval(e.data);\n        } catch (err) {\n          const root = document.querySelector('#root');\n          root.innerHTML = '<h2 style=\"color:orange\">Runtime Error!</h2><div>' + err + '</div>';\n        }\n      }, false);\n    </script>\n  </body>\n</html>\n`;\n\nexport default baseHTML;\n","import * as esbuild from 'esbuild-wasm';\nimport axios from 'axios';\nimport localforage from 'localforage';\n\nconst localCache = localforage.createInstance({\n  name: 'filecache',\n});\n\nexport const moduleRequestPlugin = (input: string) => {\n  return {\n    name: 'fetch-plugin',\n    setup(build: esbuild.PluginBuild) {\n      build.onLoad({ filter: /(^index\\.js$)/ }, () => {\n        return {\n          loader: 'jsx',\n          contents: input,\n        };\n      });\n\n      build.onLoad({ filter: /.*/ }, async (args: any) => {\n        // Return item without request if already present in cache\n        const cachedResult = await localCache.getItem<esbuild.OnLoadResult>(\n          args.path\n        );\n        if (cachedResult) {\n          return cachedResult;\n        }\n      });\n\n      build.onLoad({ filter: /.css$/ }, async (args: any) => {\n        // Return new object containing path to follow for onload process\n        const { data, request } = await axios.get(args.path);\n\n        const cleanedData = data\n          .replace(/\\n/g, '')\n          .replace(/\"/g, '\\\\\"')\n          .replace(/'/g, \"\\\\'\");\n        const contents = `\n          const style = document.createElement('style');\n          style.innerText = '${cleanedData}';\n          document.head.appendChild(style);\n        `;\n\n        const result: esbuild.OnLoadResult = {\n          loader: 'jsx',\n          contents,\n          resolveDir: new URL('./', request.responseURL).pathname,\n        };\n        await localCache.setItem(args.path, result);\n\n        return result;\n      });\n\n      build.onLoad({ filter: /.*/ }, async (args: any) => {\n        // Return new object containing path to follow for onload process\n        const { data, request } = await axios.get(args.path);\n    \n        const result: esbuild.OnLoadResult = {\n          loader: 'jsx',\n          contents: data,\n          resolveDir: new URL('./', request.responseURL).pathname,\n        };\n        await localCache.setItem(args.path, result);\n\n        return result;\n      });\n    },\n  };\n};\n","import * as esbuild from 'esbuild-wasm';\n\nexport const pathResolvePlugin = () => {\n  return {\n    name: 'unpkg-path-plugin',\n    setup(build: esbuild.PluginBuild) {\n      // Building with only local code with no importing\n      build.onResolve({ filter: /(^index\\.js$)/ }, () => {\n        return { path: 'index.js', namespace: 'a' };\n      });\n\n      // Building with package that is build on other packages\n      build.onResolve({ filter: /^\\.+\\// }, (args: any) => {\n        return {\n          namespace: 'a',\n          path: new URL(args.path, 'https://unpkg.com' + args.resolveDir + '/')\n            .href,\n        };\n      });\n\n      // Base case package import\n      build.onResolve({ filter: /.*/ }, async (args: any) => {\n        return {\n          namespace: 'a',\n          path: `https://unpkg.com/${args.path}`,\n        };\n      });\n    },\n  };\n};\n","import { ResizableBox, ResizableBoxProps } from 'react-resizable';\nimport '../styles/box.css';\n\ninterface BoxProps {\n  direction: 's' | 'w' | 'e' | 'n' | 'sw' | 'nw' | 'se' | 'ne';\n  children: React.ReactNode;\n}\n\nconst Box = ({ direction, children }: BoxProps) => {\n  let resiseableProps: ResizableBoxProps;\n\n  if (direction === 's') {\n    resiseableProps = {\n      maxConstraints: [Infinity, window.innerHeight * 0.8],\n      height: window.innerHeight * 0.5,\n      width: Infinity,\n      resizeHandles: [direction],\n      minConstraints: [Infinity, window.innerHeight * 0.2],\n    };\n  } else {\n    resiseableProps = {\n      maxConstraints: [window.innerWidth * 0.8, Infinity],\n      width: window.innerWidth * 0.5,\n      height: window.innerHeight * 0.5,\n      resizeHandles: [direction],\n      minConstraints: [window.innerWidth * 0.3, Infinity],\n    };\n  }\n\n  return <ResizableBox {...resiseableProps}>{children}</ResizableBox>;\n};\n\nexport default Box;\n","import MonacoEditor, { OnMount, OnChange } from '@monaco-editor/react';\n\ninterface Properties {\n  onChange: OnChange;\n  onMount: OnMount;\n}\n\nconst Editor = ({ onChange, onMount }: Properties) => {\n  return (\n    <MonacoEditor\n      theme='vs-dark'\n      height='100%'\n      width='calc(100% - 13px)'\n      defaultLanguage='javascript'\n      defaultValue='/* Use \"print()\" to show items in the result widow */'\n      options={{\n        wordWrap: 'on',\n        minimap: { enabled: false },\n        lineNumbersMinChars: 3,\n        folding: false,\n        fontSize: 16,\n        automaticLayout: true,\n      }}\n      onChange={onChange}\n      onMount={onMount}\n    />\n  );\n};\n\nexport default Editor;\n","import { useState, useRef } from 'react';\nimport ReactDOM from 'react-dom';\nimport { OnChange, OnMount } from '@monaco-editor/react';\nimport baseHTML from './components/base-output';\nimport 'bulmaswatch/darkly/bulmaswatch.min.css';\nimport transpile from './transpiler';\nimport Box from './components/Box';\nimport Editor from './components/Editor';\n\nconst App = () => {\n  const iframe = useRef<HTMLIFrameElement>(null);\n  const [input, setInput] = useState('');\n\n  const handleEditorChange: OnChange = (value) => {\n    if (!value) {\n      return;\n    }\n    setInput(value);\n  };\n  const handleMount: OnMount = (monaco) => {\n    monaco.getModel()?.updateOptions({ tabSize: 2 });\n  };\n\n  // Assigned to button to send a service req to esbuild\n  const handleTranspileClick = async () => {\n    if (!iframe.current || !iframe.current.contentWindow) {\n      return;\n    }\n\n    // reset the iframe window before each code run to remove any changes to page\n    iframe.current.srcdoc = baseHTML;\n\n    const transpiledCode = await transpile(input);\n    // communicating all code through messages to maintain no relation between parent child\n    iframe.current.contentWindow.postMessage(transpiledCode, '*');\n  };\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', }}>\n      <div className='main-header'>\n        <h1 className='title is-3' style={{ margin: '10px' }}>\n          Online JS Editor\n        </h1>\n      </div>\n      <Box direction='s'>\n        <div className='main-content-area' style={{ height: '100%', display: 'flex' }}>\n          <div className='editor-area' style={{ height: \"100%\", width: 'calc(100% - 13px)', display: 'flex', flexDirection: 'column'}}>\n            {/* <Box direction='e'> */}\n              <div className='main-content-area' style={{ height: '100%', display: 'flex' }}>\n                <Editor onChange={handleEditorChange} onMount={handleMount} />\n              </div>\n            {/* </Box> */}\n          </div>\n          <div className='iframe-zone' style={{  width: '100%', height: '100%', }}>\n            {/* <Box direction='w'> */}\n              <iframe\n                style={{ backgroundColor: \"white\"}}\n                height='100%'\n                width='100%'\n                ref={iframe}\n                title='code-result' \n                sandbox='allow-scripts'\n                srcDoc={baseHTML}\n              />\n            {/* </Box> */}\n          </div>\n        </div>\n      </Box>\n      <div style={{ display: 'relative' }}>\n        <button className='button is-primary' onClick={handleTranspileClick}>Run!</button>\n      </div>\n    </div>\n  );\n};\n\nReactDOM.render(<App />, document.querySelector('#root'));\n"],"sourceRoot":""}